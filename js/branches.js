(()=>{const UI={estado:document.getElementById('c-estado'),ciudad:document.getElementById('c-ciudad'),q:document.getElementById('c-q'),grid:document.getElementById('centros')};function mapLink(c){if(typeof c.lat!=='undefined'&&typeof c.lng!=='undefined') return `https://www.google.com/maps?q=${c.lat},${c.lng}`;const q=encodeURIComponent(`${c.nombre||''} ${c.ciudad||''} ${c.estado||''}`);return `https://www.google.com/maps/search/?api=1&query=${q}`;}function card(c){return `<article class='card'><div class='img'><img src='assets/branch1.jpg' alt='${c.nombre||'Centro'}'/></div><div class='card-body'><h3 class='card-title'>${c.nombre||'Centro'}</h3><p class='card-meta'>${[c.ciudad,c.estado].filter(Boolean).join(', ')}</p><p class='card-meta'>${c.direccion||''}</p></div><div class='card-cta'><a class='btn primary' href='${mapLink(c)}' target='_blank' rel='noopener'>Ver mapa</a><a class='btn' href='https://wa.me/${(c.whatsapp||'522225773967').replace(/\D/g,'')}' target='_blank' rel='noopener'>WhatsApp</a></div></article>`;}function render(list){UI.grid.innerHTML=list.length?list.map(card).join(''):'<p class="muted">No hay resultados.</p>'; }function dedup(a){return [...new Set(a)].filter(Boolean).sort((x,y)=>(''+x).localeCompare(''+y,'es',{numeric:true}));}fetch('data/centers.json').then(r=>r.json()).then(arr=>{const centers=Array.isArray(arr)?arr:[];const estados=dedup(centers.map(c=>c.estado));UI.estado.innerHTML='<option value="">Todos</option>'+estados.map(e=>`<option>${e}</option>`).join('');UI.estado.addEventListener('change',()=>{const st=UI.estado.value;const ciudades=dedup(centers.filter(c=>!st||c.estado===st).map(c=>c.ciudad));UI.ciudad.disabled=false;UI.ciudad.innerHTML='<option value="">Todas</option>'+ciudades.map(x=>`<option>${x}</option>`).join('');apply();});UI.ciudad.addEventListener('change',apply);UI.q.addEventListener('input',apply);function apply(){const st=UI.estado.value,ci=UI.ciudad.value,q=(UI.q.value||'').toLowerCase();let list=[...centers];if(st) list=list.filter(c=>c.estado===st);if(ci) list=list.filter(c=>c.ciudad===ci);if(q) list=list.filter(c=>JSON.stringify(c).toLowerCase().includes(q));render(list);}render(centers);});})();